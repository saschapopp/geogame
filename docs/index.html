<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Geo Game</title>
    <meta name="author" content="Michael FÃ¶ger, Sascha Popp, Claudio Scheiber, Helene Wechselberger">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link href="manifest.webmanifest" rel="manifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#2b3e51">
    <meta name="msapplication-TileColor" content="#2b3e51">
    <meta name="theme-color" content="#2b3e51">
    
    <link href="css/leaflet.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

    <script src="js/leaflet.js"></script>
    <script src="https://rawgithub.com/mylen/leaflet.TileLayer.WMTS/master/leaflet-tilelayer-wmts.js"></script>
    

</head>

<body onload="start();">
    
    <div id="mapid"></div>
    <div id="debug"></div>
    
    <script>

		var mymap = new L.Map('mapid');
		var marker;
		var ign;




		//var pois = new Array();

		var poi1 = new L.LatLng(47.5839578, 12.1733215); //FH
		var poi2 = new L.LatLng(47.583422, 12.170462); //Theater

		var fm1, fm2, fm3, fm4, fm5;


		//pois.push(poi1);
		//pois.push(poi2);




        function start() {
                // Check whether browser supports Geolocation API or not
                if (navigator.geolocation) { // Supported

                    var positionOptions = {
                        timeout: Infinity,
                        maximumAge: 0,
                        enableHighAccuracy: true
                    }

                    navigator.geolocation.getCurrentPosition(getPosition, catchError, positionOptions);
                    // watchID = navigator.geolocation.watchPosition(getPosition, catchError, positionOptions);


                } else { // Not supported
                    alert("Oops! This browser does not support HTML Geolocation.");
                }
            }


        function getPosition(position) {

				//FIXED MARKER ICON
				var greenIcon = L.icon({
					iconUrl: 'https://upload.wikimedia.org/wikipedia/commons/e/ec/RedDot.svg',
					iconSize:     [20, 20], // size of the icon
				});

               
                //var mymap = new L.Map('mapid');
                var latlng = new L.LatLng(position.coords.latitude, position.coords.longitude);

				//console.log(typeof position.coords.latitude);

                mymap.setZoom(11);
                mymap.setView(latlng, 18);

                ign = new L.tileLayer("https://{s}.wien.gv.at/basemap/bmaporthofoto30cm/normal/google3857/{z}/{y}/{x}.jpeg", {
                    subdomains: ['maps', 'maps1', 'maps2', 'maps3', 'maps4'],
                    attribution: '&copy; <a href="http://basemap.at">Basemap.at</a>,Claudio, Helene, Michael, Sascha',
                    maxNativeZoom: 19,
                    maxZoom: 18
                });

				//DYN MARKER
                mymap.addLayer(ign);


				//FIXED MARKER
				fm1 = L.marker(poi2, {icon: greenIcon}).addTo(mymap);
				fm2 = L.marker(poi2, {icon: greenIcon}).addTo(mymap);


                marker = L.marker(latlng).addTo(mymap);//set default marker
        }





		//TEST
		function updateMarker(position){
			var lat = position.coords.latitude;
			var lng = position.coords.longitude;
			marker.setLatLng([lat, lng]).update(); 
		}



        function catchError(positionError) {
                switch (positionError.code) {
                    case positionError.TIMEOUT:
                        alert("The request to get user location has aborted as it has taken too long.");
                        break;
                    case positionError.POSITION_UNAVAILABLE:
                        alert("Location information is not available.");
                        break;
                    case positionError.PERMISSION_DENIED:
                        alert("Permission to share location information has been denied!");
                        break;
                    default:
                        alert("An unknown error occurred.");
                }
        }



	//Listener
	var watchID = navigator.geolocation.watchPosition(function(position) {
		updateMarker(position);
	});


    </script>

</body>

</html>